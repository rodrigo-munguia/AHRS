function [phi,theta,psi,Pe] = Quaternion_To_Euler_COVM(b,Pq)


    phi = atan2(2*(b(3)*b(4)- b(1)*b(2)),1 - 2*(b(2)^2 + b(3)^2) ); %Aided Navigation %10.3
    theta = asin(-2*( b(1)*b(3) + b(2)*b(4)) ); %  10.4
    psi = atan2(2*(b(2)*b(3)- b(1)*b(4)) , 1 - 2*(b(3)^2 + b(4)^2) ); % 10.5
   
 q1 = b(1);
 q2 = b(2);
 q3 = b(3);
 q4 = b(4);
    
    
 dfe_dq = [[ -(2*q2)/((2*q2^2 + 2*q1*q2 + 2*q3^2 - 2*q4*q3)^2 + 1), -(2*q1 + 4*q2)/((2*q2^2 + 2*q1*q2 + 2*q3^2 - 2*q4*q3)^2 + 1), -(4*q3 - 2*q4)/((2*q2^2 + 2*q1*q2 + 2*q3^2 - 2*q4*q3)^2 + 1),         (2*q3)/((2*q2^2 + 2*q1*q2 + 2*q3^2 - 2*q4*q3)^2 + 1)]
           [             -(2*q3)/(1 - (2*q1*q3 + 2*q2*q4)^2)^(1/2),                    -(2*q4)/(1 - (2*q1*q3 + 2*q2*q4)^2)^(1/2),                    -(2*q1)/(1 - (2*q1*q3 + 2*q2*q4)^2)^(1/2),                    -(2*q2)/(1 - (2*q1*q3 + 2*q2*q4)^2)^(1/2)]
           [ -(2*q4)/((2*q3^2 - 2*q2*q3 + 2*q4^2 + 2*q1*q4)^2 + 1),         (2*q3)/((2*q3^2 - 2*q2*q3 + 2*q4^2 + 2*q1*q4)^2 + 1),  (2*q2 - 4*q3)/((2*q3^2 - 2*q2*q3 + 2*q4^2 + 2*q1*q4)^2 + 1), -(2*q1 + 4*q4)/((2*q3^2 - 2*q2*q3 + 2*q4^2 + 2*q1*q4)^2 + 1)]];
   
       
    
 Pe = dfe_dq*Pq*dfe_dq';